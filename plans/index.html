<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Country Coverage – Roampass</title>
  <!-- Tailwind CDN  (quick demo; replace with local build in production) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">eSIM Coverage Countries</h1>

    <!-- Country grid -->
    <div id="countryGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
  </div>

  <script>

    const DATA_URL = "https://pub-6c2916641e234c18a33f84fd64d78e70.r2.dev/plans.json";

    async function loadCountries() {
      try {
        const res = await fetch(DATA_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const plans = await res.json();

        // Extract countries & minimum price
        const countries = plans.map(entry => {
          const minPrice = Math.min(...entry.plans.map(p => p.price));
          return { name: entry.country, price: minPrice };
        }).sort((a, b) => a.name.localeCompare(b.name));

        renderCountries(countries);
      } catch (err) {
        console.error("Failed to load plans.json", err);
        document.getElementById("countryGrid").innerHTML =
          `<p class='text-red-600 col-span-full text-center'>Failed to load data 😢</p>`;
      }
    }

    function renderCountries(list) {
      const grid = document.getElementById("countryGrid");
      grid.innerHTML = "";
      list.forEach(({ name, price }) => {
        const card = document.createElement("a");
        card.href = `./countries/${encodeURIComponent(name.toLowerCase())}.html`;
        card.className = "bg-white shadow rounded-xl p-4 flex flex-col items-center hover:ring-2 hover:ring-blue-400 transition";
        card.innerHTML = `
          <span class='text-2xl mb-2'>🌐</span>
          <h2 class='font-semibold mb-1 text-center'>${name}</h2>
          <p class='text-sm text-gray-600'>from $${price.toFixed(2)}</p>
        `;
        grid.appendChild(card);
      });
    }

    loadCountries();
  </script>
</body>
</html>
